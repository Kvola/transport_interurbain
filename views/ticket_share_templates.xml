<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template pour afficher un billet partag√© -->
    <template id="ticket_share_view" name="Billet de transport partag√©">
        <t t-call="web.layout">
            <t t-set="head">
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
                <style>
                    body {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        min-height: 100vh;
                        padding: 20px 0;
                    }
                    .ticket-container {
                        max-width: 420px;
                        margin: 0 auto;
                    }
                    .ticket-card {
                        background: white;
                        border-radius: 20px;
                        overflow: hidden;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    }
                    .ticket-header {
                        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                        color: white;
                        padding: 25px;
                        text-align: center;
                    }
                    .ticket-header h1 {
                        font-size: 1.5rem;
                        margin-bottom: 5px;
                    }
                    .ticket-header .ticket-number {
                        font-size: 0.9rem;
                        opacity: 0.9;
                        letter-spacing: 2px;
                    }
                    .gift-badge {
                        display: inline-block;
                        background: #ff9800;
                        color: white;
                        padding: 5px 15px;
                        border-radius: 20px;
                        font-size: 0.8rem;
                        margin-bottom: 10px;
                    }
                    .route-section {
                        padding: 25px;
                        text-align: center;
                        border-bottom: 2px dashed #eee;
                        position: relative;
                    }
                    .route-section::before,
                    .route-section::after {
                        content: '';
                        position: absolute;
                        width: 30px;
                        height: 30px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 50%;
                        top: 50%;
                        transform: translateY(-50%);
                    }
                    .route-section::before { left: -15px; }
                    .route-section::after { right: -15px; }
                    .city-name {
                        font-size: 1.3rem;
                        font-weight: 700;
                        color: #1e3c72;
                    }
                    .city-time {
                        font-size: 2rem;
                        font-weight: 800;
                        color: #333;
                    }
                    .route-arrow {
                        font-size: 2rem;
                        color: #1e3c72;
                        margin: 10px 0;
                    }
                    .ticket-details {
                        padding: 20px 25px;
                    }
                    .detail-row {
                        display: flex;
                        justify-content: space-between;
                        padding: 10px 0;
                        border-bottom: 1px solid #f0f0f0;
                    }
                    .detail-row:last-child {
                        border-bottom: none;
                    }
                    .detail-label {
                        color: #888;
                        font-size: 0.85rem;
                    }
                    .detail-value {
                        font-weight: 600;
                        color: #333;
                    }
                    .buyer-info {
                        background: #fff3e0;
                        padding: 15px;
                        margin: 15px;
                        border-radius: 10px;
                        border-left: 4px solid #ff9800;
                    }
                    .qr-section {
                        text-align: center;
                        padding: 25px;
                        background: #f8f9fa;
                    }
                    .qr-section img {
                        max-width: 200px;
                        border-radius: 10px;
                    }
                    .qr-hint {
                        font-size: 0.8rem;
                        color: #666;
                        margin-top: 10px;
                    }
                    .ticket-footer {
                        padding: 15px 25px;
                        background: #f8f9fa;
                        text-align: center;
                    }
                    .download-btn {
                        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                        color: white;
                        padding: 12px 30px;
                        border-radius: 25px;
                        text-decoration: none;
                        display: inline-block;
                        margin: 5px;
                        font-weight: 600;
                    }
                    .download-btn:hover {
                        opacity: 0.9;
                        color: white;
                    }
                    .status-badge {
                        display: inline-block;
                        padding: 5px 15px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        font-weight: 600;
                    }
                    .status-confirmed { background: #e8f5e9; color: #2e7d32; }
                    .status-checked_in { background: #e3f2fd; color: #1565c0; }
                    .status-completed { background: #f3e5f5; color: #7b1fa2; }
                </style>
            </t>
            <t t-set="body_classname" t-value="'ticket-share-page'"/>
            
            <div class="ticket-container">
                <div class="ticket-card">
                    <!-- En-t√™te -->
                    <div class="ticket-header">
                        <t t-if="is_for_other">
                            <div class="gift-badge">
                                üéÅ Billet offert
                            </div>
                        </t>
                        <h1><t t-esc="company.name"/></h1>
                        <div class="ticket-number">
                            N¬∞ <t t-esc="ticket_number"/>
                        </div>
                        <div class="mt-2">
                            <span t-attf-class="status-badge status-#{status}">
                                <t t-esc="status_label"/>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Section trajet -->
                    <div class="route-section">
                        <div class="row align-items-center">
                            <div class="col-5">
                                <div class="city-time">
                                    <t t-esc="departure_datetime.strftime('%H:%M') if departure_datetime else '-'"/>
                                </div>
                                <div class="city-name">
                                    <t t-esc="route.departure_city_id.name"/>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="route-arrow">‚Üí</div>
                            </div>
                            <div class="col-5">
                                <div class="city-name">
                                    <t t-esc="route.arrival_city_id.name"/>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                üìÖ <t t-esc="departure_datetime.strftime('%A %d %B %Y') if departure_datetime else '-'"/>
                            </small>
                        </div>
                    </div>
                    
                    <!-- D√©tails du billet -->
                    <div class="ticket-details">
                        <div class="detail-row">
                            <span class="detail-label">üë§ Passager</span>
                            <span class="detail-value"><t t-esc="passenger_name"/></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üì± T√©l√©phone</span>
                            <span class="detail-value"><t t-esc="passenger_phone"/></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üí∫ Si√®ge</span>
                            <span class="detail-value"><t t-esc="seat"/></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">üìç Point de rencontre</span>
                            <span class="detail-value"><t t-esc="meeting_point or '√Ä confirmer'"/></span>
                        </div>
                    </div>
                    
                    <!-- Info acheteur si cadeau -->
                    <t t-if="is_for_other and buyer_name">
                        <div class="buyer-info">
                            <small>üéÅ Ce billet vous a √©t√© offert par</small>
                            <div class="fw-bold"><t t-esc="buyer_name"/></div>
                        </div>
                    </t>
                    
                    <!-- QR Code -->
                    <div class="qr-section">
                        <t t-if="qr_code">
                            <img t-attf-src="data:image/png;base64,#{qr_code}" alt="QR Code du billet"/>
                            <div class="qr-hint">
                                Pr√©sentez ce QR code √† l'embarquement
                            </div>
                        </t>
                        <t t-else="">
                            <p class="text-muted">QR Code non disponible</p>
                        </t>
                    </div>
                    
                    <!-- Pied de page -->
                    <div class="ticket-footer">
                        <a t-attf-href="/ticket/share/#{booking.share_token}/download" class="download-btn">
                            üì• T√©l√©charger PDF
                        </a>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <small class="text-white opacity-75">
                        Billet g√©n√©r√© par <t t-esc="company.name"/>
                    </small>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Template pour billet non trouv√© -->
    <template id="ticket_share_not_found" name="Billet non trouv√©">
        <t t-call="web.layout">
            <t t-set="head">
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
                <style>
                    body {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    .error-card {
                        background: white;
                        border-radius: 20px;
                        padding: 40px;
                        text-align: center;
                        max-width: 400px;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    }
                    .error-icon {
                        font-size: 4rem;
                        margin-bottom: 20px;
                    }
                </style>
            </t>
            
            <div class="error-card">
                <div class="error-icon">üé´‚ùå</div>
                <h2>Billet non trouv√©</h2>
                <p class="text-muted">
                    Ce lien de partage est invalide ou le billet n'est plus disponible.
                </p>
                <p class="small text-muted">
                    Veuillez contacter la personne qui vous a partag√© ce billet.
                </p>
            </div>
        </t>
    </template>
</odoo>
